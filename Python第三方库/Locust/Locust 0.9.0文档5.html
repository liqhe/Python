<!DOCTYPE html>
<!-- saved from url=(0058)https://docs.locust.io/en/stable/writing-a-locustfile.html -->
<html class="js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths translated-ltr" lang="zh-CN" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>编写locustfile  -  Locust 0.9.0文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="./Locust 0.9.0文档5_files/theme.css" type="text/css">
  <link rel="stylesheet" href="./Locust 0.9.0文档5_files/pygments.css" type="text/css">
    <link rel="index" title="指数" href="https://docs.locust.io/en/stable/genindex.html">
    <link rel="search" title="搜索" href="https://docs.locust.io/en/stable/search.html">
    <link rel="next" title="运行Locust分布式" href="https://docs.locust.io/en/stable/running-locust-distributed.html">
    <link rel="prev" title="快速开始" href="https://docs.locust.io/en/stable/quickstart.html"> 

  
  <script async="" src="./Locust 0.9.0文档5_files/analytics.js"></script><script src="./Locust 0.9.0文档5_files/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.locust.io/en/stable/writing-a-locustfile.html">

<link rel="stylesheet" href="./Locust 0.9.0文档5_files/readthedocs-doc-embed.css" type="text/css">

<script type="text/javascript" src="./Locust 0.9.0文档5_files/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'writing-a-locustfile'
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="./Locust 0.9.0文档5_files/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./Locust 0.9.0文档5_files/translateelement.css"></head>

<body class="wy-body-for-nav" style="">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://docs.locust.io/en/stable/index.html" class="icon icon-home"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 刺槐
          

          
          </font></font></a>

          
            
            
            
              <div class="version"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                稳定
              </font></font></div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://docs.locust.io/en/stable/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/what-is-locust.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么是蝗虫？</font></font></a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/installation.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装</font></font></a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/quickstart.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速开始</font></font></a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal current" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一个locustfile</font></font></a><ul>
<li class="toctree-l2"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-locust-class"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蝗虫类</font></font></a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-task-set-attribute"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="docutils literal notranslate"><span class="pre">task_set</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-min-wait-and-max-wait-attributes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_WAIT</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-weight-attribute"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重量</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-host-attribute">The <em>host</em> attribute</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#taskset-class"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet类</font></font></a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#declaring-tasks">Declaring tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#tasks-attribute">tasks attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#tasksets-can-be-nested">TaskSets can be nested</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#referencing-the-locust-instance-or-the-parent-taskset-instance">Referencing the Locust instance, or the parent TaskSet instance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#tasksequence-class"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSequence类</font></font></a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#setups-teardowns-on-start-and-on-stop"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setups，Teardowns，on_start和on_stop</font></font></a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#setups-and-teardowns">Setups and Teardowns</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-on-start-and-on-stop-methods">The on_start and on_stop methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#order-of-events">Order of events</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#making-http-requests"><span class="toctree-expand"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发出HTTP请求</font></font></a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#using-the-http-client">Using the HTTP client</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#safe-mode">Safe mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#manually-controlling-if-a-request-should-be-considered-successful-or-a-failure">Manually controlling if a request should be considered successful or a failure</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#grouping-requests-to-urls-with-dynamic-parameters">Grouping requests to URLs with dynamic parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#common-libraries"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常用库</font></font></a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/running-locust-distributed.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行Locust分布式</font></font></a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/running-locust-without-web-ui.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在没有Web UI的情况下运行Locust</font></font></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/retrieving-stats.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以CSV格式检索测试统计信息</font></font></a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/testing-other-systems.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用自定义客户端测试其他系统</font></font></a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/api.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/extending-locust.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩大蝗虫</font></font></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/third-party-tools.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三方工具</font></font></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.locust.io/en/stable/changelog.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变更日志亮点</font></font></a></li>
</ul>

            
          
        </div>
      <div id="rtd-wup7t406" class="ethical-rtd ethical-dark-theme"><div class="ethical-sidebar"><div class="ethical-content"><a href="https://readthedocs.org/sustainability/click/305/Emz3zfgQadYe/" rel="nofollow" target="_blank" class="ethical-image-link"><img src="./Locust 0.9.0文档5_files/readthedocs-logo-fs8.png"></a><div class="ethical-text"><a href="https://readthedocs.org/sustainability/click/305/Emz3zfgQadYe/" rel="nofollow" target="_blank"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私人回购和优先支持</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试阅读今日商业文档！</font></font></a></div></div><div class="ethical-callout"><small><em><a href="https://readthedocs.org/sustainability/advertising/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">赞助商</font></font></a><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">· </font></font></span><a href="https://docs.readthedocs.io/en/latest/ethical-advertising.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道德服务广告</font></font></a></em></small></div></div><img src="./Locust 0.9.0文档5_files/saved_resource" style="display: none;"></div></div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://docs.locust.io/en/stable/index.html">Locust</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="https://docs.locust.io/en/stable/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> »</font></font></li>
        
      <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一个locustfile</font></font></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/locustio/locust/blob/4bde2ca90f28bde649ff4ce2c86e36a6e6260856/docs/writing-a-locustfile.rst" class="fa fa-github"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在GitHub上编辑</font></font></a>
            
          
        
      </li>
    
  </ul>

  
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-a-locustfile">
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写locustfile </font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#writing-a-locustfile" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h1>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">locustfile是普通的python文件。</font><font style="vertical-align: inherit;">唯一的要求是它声明至少有一个类 - 我们称之为蝗虫类 - 它继承自Locust类。</font></font></p>
<div class="section" id="the-locust-class">
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Locust类</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-locust-class" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蝗虫类代表一个用户（如果你愿意，代表蜂群蝗虫）。</font><font style="vertical-align: inherit;">Locust将为每个正在模拟的用户生成（孵化）一个蝗虫类实例。</font><font style="vertical-align: inherit;">蝗虫类通常应该定义一些属性。</font></font></p>
<div class="section" id="the-task-set-attribute">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.Locust.task_set" title="locust.core.Locust.task_set"><code class="xref py py-attr docutils literal notranslate"><span class="pre">task_set</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-task-set-attribute" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.Locust.task_set" title="locust.core.Locust.task_set"><code class="xref py py-attr docutils literal notranslate"><span class="pre">task_set</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性应指向
 </font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义用户行为的类，并在下面更详细地描述。</font></font></p>
</div>
<div class="section" id="the-min-wait-and-max-wait-attributes">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_WAIT</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-min-wait-and-max-wait-attributes" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了task_set属性之外，通常还需要声明</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
属性。</font><font style="vertical-align: inherit;">这些是模拟用户在执行每个任务之间等待的最小和最大时间（以毫秒为单位）。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认为1000，因此如果</font><font style="vertical-align: inherit;">未声明</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_wait，</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则</font><font style="vertical-align: inherit;">每个任务之间的蝗虫将始终等待1秒</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下locustfile，每个用户将在任务之间等待5到15秒：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="kn">import</span> <span class="n">Locust</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">task</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span>
    <span class="k">def</span> <span class="nf">my_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"executing my_task"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
    <span class="n">min_wait</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="n">max_wait</span> <span class="o">=</span> <span class="mi">15000</span>
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_WAIT</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性也可以在使用taskset类中重写。</font></font></p>
</div>
<div class="section" id="the-weight-attribute">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重量</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-weight-attribute" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以从同一个文件中运行两个蝗虫，如下所示：</font></font></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> locust -f locust_file.py WebUserLocust MobileUserLocust
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您希望更频繁地执行其中一个蝗虫，您可以在这些类上设置权重属性。</font><font style="vertical-align: inherit;">比如说，网络用户比移动用户的可能性高三倍：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WebUserLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MobileUserLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="the-host-attribute">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-host-attribute" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">host属性是</font><font style="vertical-align: inherit;">要加载的主机</font><font style="vertical-align: inherit;">的URL前缀（即“ </font></font><a class="reference external" href="https://google.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://google.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”）。</font><font style="vertical-align: inherit;">通常，这是在命令行上使用</font></font><code class="code docutils literal notranslate"><span class="pre">--host</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项在启动locust时</font><font style="vertical-align: inherit;">指定的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果在locust类中声明了一个host属性，那么</font></font><code class="code docutils literal notranslate"><span class="pre">--host</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在命令行中指定</font><font style="vertical-align: inherit;">no时将使用它</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="section" id="taskset-class">
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet类</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#taskset-class" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果Locust类代表一个蜂拥而至的蝗虫，你可以说TaskSet类代表了蝗虫的大脑。</font><font style="vertical-align: inherit;">每个Locust类必须设置一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">task_set</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性，指向TaskSet。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如其名称所示，TaskSet是一组任务。</font><font style="vertical-align: inherit;">这些任务是正常的python callables  - 如果我们负载测试一个拍卖网站 - 可以做一些事情，如“加载起始页”，“搜索一些产品”和“出价”。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动负载测试时，生成的Locust类的每个实例都将开始执行其TaskSet。</font><font style="vertical-align: inherit;">然后发生的是每个TaskSet将选择其中一个任务并调用它。</font><font style="vertical-align: inherit;">然后等待几个毫秒，在Locust类的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">min_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">max_wait</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">之间随机选择</font><font style="vertical-align: inherit;">（除非min_wait / max_wait直接在TaskSet下定义，在这种情况下它将使用自己的值）。</font><font style="vertical-align: inherit;">然后它将再次选择要调用的新任务，再次等待，依此类推。</font></font></p>
<div class="section" id="declaring-tasks">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明任务</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#declaring-tasks" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为TaskSet声明任务的典型方法是使用</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.task" title="locust.core.task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">装饰器。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个例子：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="kn">import</span> <span class="n">Locust</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">task</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span>
    <span class="k">def</span> <span class="nf">my_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Locust instance (</span><span class="si">%r</span><span class="s2">) executing my_task"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locust</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
</pre></div>
</div>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@task</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">采用可选的权重参数，可用于指定任务的执行率。</font><font style="vertical-align: inherit;">在以下示例中，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">task2的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行次数是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">task1的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两倍</font><font style="vertical-align: inherit;">：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="kn">import</span> <span class="n">Locust</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">task</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="n">min_wait</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="n">max_wait</span> <span class="o">=</span> <span class="mi">15000</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">task1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">task2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
</pre></div>
</div>
</div>
<div class="section" id="tasks-attribute">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务属性</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#tasks-attribute" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用@task装饰器来声明任务是一种方便，通常是最好的方法。</font><font style="vertical-align: inherit;">但是，也可以通过设置</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet.tasks" title="locust.core.TaskSet.tasks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tasks</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">来定义TaskSet的任务
 </font><font style="vertical-align: inherit;">（使用@task装饰器实际上只会填充</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tasks</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的属性可以是一个可调用蟒的列表，或者一个</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;调用的：int&gt;的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字典。</font><font style="vertical-align: inherit;">任务是python callables，它们接收一个参数 - 正在执行任务的TaskSet类实例。</font><font style="vertical-align: inherit;">这是一个非常简单的locustfile示例（这个locustfile实际上不会加载测试任何东西）：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="kn">import</span> <span class="n">Locust</span><span class="p">,</span> <span class="n">TaskSet</span>

<span class="k">def</span> <span class="nf">my_task</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_task</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">Locust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果将tasks属性指定为列表，则每次执行任务时，都将从</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tasks</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中</font><font style="vertical-align: inherit;">随机选择该</font><em><font style="vertical-align: inherit;">任务</font></em><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，如果</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个dict-将callables作为键和int作为值 - 将执行的任务将随机选择，但int为比率。</font><font style="vertical-align: inherit;">所以使用如下所示的任务：</font></font></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">my_task</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">another_task</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_task</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行的可能性是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">another_task的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3倍</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="section" id="tasksets-can-be-nested">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSets可以嵌套</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#tasksets-can-be-nested" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSets的一个非常重要的属性是它们可以嵌套，因为真正的网站通常以分层方式构建，具有多个子部分。</font><font style="vertical-align: inherit;">因此，嵌套TaskSet将允许我们定义以更逼真的方式模拟用户的行为。</font><font style="vertical-align: inherit;">例如，我们可以使用以下结构定义TaskSet：</font></font></p>
<ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要用户行为</font></font></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引页面</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">论坛页面</font></font></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读线程</font></font></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">答复</font></font></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新线程</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看下一页</font></font></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览分类</font></font></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看电影</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤电影</font></font></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于页面</font></font></li>
</ul>
</div></blockquote>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套TaskSets的方式就像使用</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tasks</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">指定任务一样</font><font style="vertical-align: inherit;">，但是不是引用python函数，而是引用另一个TaskSet：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ForumPage</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interrupt</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">UserBehaviour</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span><span class="n">ForumPage</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>

    <span class="nd">@task</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，在上面的示例中，如果在UserBehaviour TaskSet执行时选择执行ForumPage，则ForumPage TaskSet将开始执行。</font><font style="vertical-align: inherit;">然后，ForumPage TaskSet将选择其中一个任务，执行它，等待等等。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于上面的例子有一点需要注意，那就是在ForumPage的stop方法中调用self.interrupt（）。</font><font style="vertical-align: inherit;">这样做本质上是停止执行ForumPage任务集，并且将在UserBehaviour实例中继续执行。</font><font style="vertical-align: inherit;">如果我们没有</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet.interrupt" title="locust.core.TaskSet.interrupt"><code class="xref py py-meth docutils literal notranslate"><span class="pre">interrupt()</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在ForumPage中的某个地方</font><font style="vertical-align: inherit;">调用该</font><font style="vertical-align: inherit;">方法，那么Locust一旦启动就永远不会停止运行它。</font><font style="vertical-align: inherit;">但是通过具有中断功能，我们可以与任务加权一起定义模拟用户离开论坛的可能性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.task" title="locust.core.task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">@task</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">装饰器</font><font style="vertical-align: inherit;">声明嵌套在一个类中的嵌套TaskSet，
 </font><font style="vertical-align: inherit;">就像声明正常任务一样：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span>
    <span class="k">class</span> <span class="nc">SubTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
        <span class="nd">@task</span>
        <span class="k">def</span> <span class="nf">my_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="referencing-the-locust-instance-or-the-parent-taskset-instance">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用Locust实例或父TaskSet实例</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#referencing-the-locust-instance-or-the-parent-taskset-instance" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet实例将使该属性</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet.locust" title="locust.core.TaskSet.locust"><code class="xref py py-attr docutils literal notranslate"><span class="pre">locust</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向其Locust实例，并且该属性</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet.parent" title="locust.core.TaskSet.parent"><code class="xref py py-attr docutils literal notranslate"><span class="pre">parent</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向其父TaskSet（它将指向基本TaskSet中的Locust实例）。</font></font></p>
</div>
</div>
<div class="section" id="tasksequence-class">
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSequence类</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#tasksequence-class" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSequence类是一个TaskSet，但它的任务将按顺序执行。</font><font style="vertical-align: inherit;">要定义此顺序，您应该执行以下操作：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTaskSequence</span><span class="p">(</span><span class="n">TaskSequence</span><span class="p">):</span>
    <span class="nd">@seq_task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">first_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@seq_task</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">second_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@seq_task</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nd">@task</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">third_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的示例中，顺序被定义为执行first_task，然后执行second_task，最后执行third_task 10次。</font><font style="vertical-align: inherit;">如您所见，您可以</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.seq_task" title="locust.core.seq_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">@seq_task</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.task" title="locust.core.task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">@task</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">装饰器</font><font style="vertical-align: inherit;">进行组合</font><font style="vertical-align: inherit;">，当然您也可以在TaskSequences中嵌套TaskSet，反之亦然。</font></font></p>
</div>
<div class="section" id="setups-teardowns-on-start-and-on-stop">
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置，保修查询，on_start和on_stop </font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#setups-teardowns-on-start-and-on-stop" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Locust可选地支持</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.Locust" title="locust.core.Locust"><code class="xref py py-class docutils literal notranslate"><span class="pre">Locust</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">level </font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">level </font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">和</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a> <code class="xref py py-meth docutils literal notranslate"><span class="pre">on_start</span></code><font style="vertical-align: inherit;"></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_stop</span></code></p>
<div class="section" id="setups-and-teardowns">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置和拆解</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#setups-and-teardowns" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，无论是运行</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.Locust" title="locust.core.Locust"><code class="xref py py-class docutils literal notranslate"><span class="pre">Locust</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还是</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，都是只运行一次的方法。
</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在任务开始运行之前运行，而</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在所有任务完成并且Locust退出后运行。</font><font style="vertical-align: inherit;">这使您可以在任务开始运行之前执行一些准备工作（如创建数据库）并在Locust退出之前进行清理（如删除数据库）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用，只需</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">声明</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和/或</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些方法将为您运行。</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown</span></code><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.Locust" title="locust.core.Locust"><code class="xref py py-class docutils literal notranslate"><span class="pre">Locust</span></code></a><font style="vertical-align: inherit;"></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="section" id="the-on-start-and-on-stop-methods">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on_start和on_stop方法</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#the-on-start-and-on-stop-methods" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet类可以声明</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_start</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法或</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_stop</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font><font style="vertical-align: inherit;">在</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_start</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当模拟用户开始执行该taskset的类方法被调用，而</font><font style="vertical-align: inherit;">上使用taskset停止时方法被调用。</font></font><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_stop</span> <span class="pre">&lt;locust.core.TaskSet.on_stop()</span></code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="section" id="order-of-events">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件顺序</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#order-of-events" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于许多设置和清理操作彼此依赖，因此以下是它们运行的​​顺序：</font></font></p>
<ol class="arabic simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蝗虫设置</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet设置</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet on_start</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet任务......</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet on_stop</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskSet拆解</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蝗虫拆解</font></font></li>
</ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，设置和拆卸方法应该是互补的。</font></font></p>
</div>
</div>
<div class="section" id="making-http-requests">
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发出HTTP请求</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#making-http-requests" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们只介绍了Locust用户的任务调度部分。</font><font style="vertical-align: inherit;">为了实际加载测试系统，我们需要发出HTTP请求。</font><font style="vertical-align: inherit;">为了帮助我们这样做，该</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.HttpLocust" title="locust.core.HttpLocust"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpLocust</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
课程存在。</font><font style="vertical-align: inherit;">使用此类时，每个实例都会获得一个</font></font><code class="xref py py-attr docutils literal notranslate"><span class="pre">client</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性，</font><font style="vertical-align: inherit;">该
 </font><font style="vertical-align: inherit;">属性的实例
 </font></font><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpSession</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于发出HTTP请求。</font></font></p>
<dl class="class">
<dt>
<em class="property"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类 </font></font></em><code class="descname">HttpLocust</code></dt>
<dd><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示要加上阴影线并攻击要进行负载测试的系统的HTTP“用户”。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该用户的行为由task_set属性定义，该属性应指向一个 
 </font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此类</font><font style="vertical-align: inherit;">在实例化上</font><font style="vertical-align: inherit;">创建</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性，该实例化是一个HTTP客户端，支持在请求之间保持用户会话。</font></font></p>
<dl class="attribute">
<dt>
<code class="descname">client</code><em class="property"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =无</font></font></em></dt>
<dd><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实例化Locust时创建的HttpSession实例。</font><font style="vertical-align: inherit;">客户端支持cookie，因此保持HTTP请求之间的会话。</font></font></p>
</dd></dl>

</dd></dl>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从HttpLocust类继承时，我们可以使用其client属性对服务器发出HTTP请求。</font><font style="vertical-align: inherit;">以下是一个locust文件的示例，可用于加载测试具有两个URL的站点; </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ about /</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">locust</span> <span class="kn">import</span> <span class="n">HttpLocust</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">task</span>

<span class="k">class</span> <span class="nc">MyTaskSet</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
    <span class="nd">@task</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">about</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/about/"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyLocust</span><span class="p">(</span><span class="n">HttpLocust</span><span class="p">):</span>
    <span class="n">task_set</span> <span class="o">=</span> <span class="n">MyTaskSet</span>
    <span class="n">min_wait</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="n">max_wait</span> <span class="o">=</span> <span class="mi">15000</span>
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用上面的Locust类，每个模拟用户将在请求之间等待5到15秒，并且</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将被请求两倍于</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ about /</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">细心的读者会发现我们可以</font><font style="vertical-align: inherit;">在TaskSet中</font><font style="vertical-align: inherit;">使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.client</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用HttpSession实例</font><font style="vertical-align: inherit;">，而不是</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.locust.client</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们可以这样做，因为</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该类有一个名为client的便捷属性，它只返回self.locust.client。</font></font></p>
<div class="section" id="using-the-http-client">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用HTTP客户端</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#using-the-http-client" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HttpLocust的每个实例都</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession" title="locust.clients.HttpSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpSession</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中</font><font style="vertical-align: inherit;">有一个实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在HttpSession类实际上是一个子类
 </font></font><a class="reference external" href="https://requests.readthedocs.io/en/latest/api/#requests.Session" title="（在请求v2.19.1中）"><code class="xref py py-class docutils literal notranslate"><span class="pre">requests.Session</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以用来做HTTP请求，将被报告给蝗虫的统计，使用</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession.get" title="locust.clients.HttpSession.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession.post" title="locust.clients.HttpSession.post"><code class="xref py py-meth docutils literal notranslate"><span class="pre">post</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession.put" title="locust.clients.HttpSession.put"><code class="xref py py-meth docutils literal notranslate"><span class="pre">put</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession.delete" title="locust.clients.HttpSession.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession.head" title="locust.clients.HttpSession.head"><code class="xref py py-meth docutils literal notranslate"><span class="pre">head</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession.patch" title="locust.clients.HttpSession.patch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">patch</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession.options" title="locust.clients.HttpSession.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">options</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法。</font><font style="vertical-align: inherit;">HttpSession实例将在请求之间保留cookie，以便它可用于登录网站并在请求之间保持会话。</font><font style="vertical-align: inherit;">客户端属性也可以从Locust实例的TaskSet实例中引用，这样就可以轻松检索客户端并从您的任务中发出HTTP请求。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个向</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ about</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径</font><font style="vertical-align: inherit;">发出GET请求的简单示例</font><font style="vertical-align: inherit;">（在这种情况下，我们假设</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
是一个</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.TaskSet" title="locust.core.TaskSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskSet</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.core.Locust" title="locust.core.Locust"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpLocust</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
类</font><font style="vertical-align: inherit;">的实例</font><font style="vertical-align: inherit;">：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/about"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Response status code:"</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Response content:"</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个发出POST请求的示例：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/login"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"username"</span><span class="p">:</span><span class="s2">"testuser"</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">:</span><span class="s2">"secret"</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="safe-mode">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全模式</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#safe-mode" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP客户端配置为在safe_mode中运行。</font><font style="vertical-align: inherit;">这样做的是，由于连接错误，超时或类似原因而失败的任何请求都不会引发异常，而是返回一个空的虚拟Response对象。</font><font style="vertical-align: inherit;">请求将在Locust的统计信息中报告为失败。</font><font style="vertical-align: inherit;">返回的虚拟Response的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性将设置为None，其</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">status_code</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将为0。</font></font></p>
</div>
<div class="section" id="manually-controlling-if-a-request-should-be-considered-successful-or-a-failure">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动控制请求是否应被视为成功或失败</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#manually-controlling-if-a-request-should-be-considered-successful-or-a-failure" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，除非HTTP响应代码正常（2xx），否则请求将标记为失败的请求。</font><font style="vertical-align: inherit;">大多数情况下，这个默认值就是你想要的。</font><font style="vertical-align: inherit;">然而，有时候 - 例如在测试您希望返回404的URL端点时，或测试设计不良的系统，</font><font style="vertical-align: inherit;">即使发生错误</font><font style="vertical-align: inherit;">也可能返回</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">200 OK</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 需要手动控制蝗虫是否应该将请求视为成功或失败。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">catch_response</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数和with语句</font><font style="vertical-align: inherit;">，即使响应代码正常，也可以将请求标记为失败
 </font><font style="vertical-align: inherit;">：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">catch_response</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="o">!=</span> <span class="sa">b</span><span class="s2">"Success"</span><span class="p">:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="s2">"Got wrong response"</span><span class="p">)</span>
</pre></div>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如可以使用OK响应代码将请求标记为失败一样，也可以将</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">catch_response</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
参数与</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">一起使用</font><em><font style="vertical-align: inherit;">，</font></em><font style="vertical-align: inherit;">以使得导致HTTP错误代码的请求仍然在统计信息中报告为成功：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/does_not_exist/"</span><span class="p">,</span> <span class="n">catch_response</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-requests-to-urls-with-dynamic-parameters">
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用动态参数将请求分组到</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#grouping-requests-to-urls-with-dynamic-parameters" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL¶</font></font></a></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站的URL通常包含某种动态参数，这是很常见的。</font><font style="vertical-align: inherit;">通常，在Locust的统计数据中将这些URL组合在一起是有意义的。</font><font style="vertical-align: inherit;">这可以通过将</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">给</font></font><a class="reference internal" href="https://docs.locust.io/en/stable/api.html#locust.clients.HttpSession" title="locust.clients.HttpSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpSession's</span></code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不同的请求方法来完成。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistics for these requests will be grouped under: /blog/?id=[id]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/blog?id=</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"/blog?id=[id]"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="common-libraries">
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共库</font></font><a class="headerlink" href="https://docs.locust.io/en/stable/writing-a-locustfile.html#common-libraries" title="永久链接到这个标题"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¶</font></font></a></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，人们希望将共享公共库的多个locust文件组合在一起。</font><font style="vertical-align: inherit;">在这种情况下，将</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目根</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义为</font><font style="vertical-align: inherit;">调用蝗虫的目录</font><font style="vertical-align: inherit;">非常重要</font><font style="vertical-align: inherit;">，并建议所有蝗虫文件都位于项目根目录下的某个位置。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平面文件结构开箱即用：</font></font></p>
<ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目根</font></font><ul>
<li><code class="docutils literal notranslate"><span class="pre">commonlib_config.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">commonlib_auth.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">locustfile_web_app.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">locustfile_api.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">locustfile_ecommerce.py</span></code></li>
</ul>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">locustfiles可以使用例如导入公共库</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，这种方法并不能将公共库与蝗虫文件完全分开。</font></font><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">commonlib_auth</span></code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子目录可以是一种更简洁的方法（参见下面的示例），但是locust只会导入相对于放置运行的locustfile的目录的模块。</font><font style="vertical-align: inherit;">如果您希望从项目根目录（即运行locust命令的位置）导入，请确保</font></font><code class="docutils literal notranslate"><span class="pre">sys.path.append(os.getcwd())</span></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在导入任何公共库之前</font><font style="vertical-align: inherit;">写入</font><font style="vertical-align: inherit;">您的locust文件 - 这将使项目成为root（即当前正在工作）目录）可导入。</font></font></p>
<ul class="simple">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目根</font></font><ul>
<li><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">common/</span></code><ul>
<li><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">config.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">auth.py</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">locustfiles/</span></code><ul>
<li><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">web_app.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">api.py</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ecommerce.py</span></code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用上述项目结构，您的locust文件可以使用以下命令导入公共库：</font></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="kn">import</span> <span class="nn">common.auth</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="https://docs.locust.io/en/stable/running-locust-distributed.html" class="btn btn-neutral float-right" title="运行Locust分布式" accesskey="n" rel="next"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一个 </font></font><span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="https://docs.locust.io/en/stable/quickstart.html" class="btn btn-neutral" title="快速开始" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 以前</font></font></a>
      
    </div>
  

  <hr><div><div id="rtd-pzmqjvy0h" class="ethical-rtd"></div></div>

  <div role="contentinfo">
    <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ©版权所有。
      
        </font></font><span class="commit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          修订</font></font><code>4bde2ca9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
        </font></font></span>
      

    </p>
  </div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><a href="https://readthedocs.org/"><font style="vertical-align: inherit;">Read the Docs</font></a><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">的</font><a href="https://github.com/rtfd/sphinx_rtd_theme"><font style="vertical-align: inherit;">主题</font></a><font style="vertical-align: inherit;"> 
  使用</font></font><a href="http://sphinx-doc.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sphinx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建</font><font style="vertical-align: inherit;">。 

</font></font><a href="https://github.com/rtfd/sphinx_rtd_theme"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://readthedocs.org/"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读文档</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
      v：stable
      </font></font><span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions"><!-- Inserted RTD Footer -->
<div class="injected">

  

      
      
      
      <dl>
        <dt>Versions</dt>
        
        
        <dd><a href="http://docs.locust.io/en/latest/writing-a-locustfile.html">latest</a></dd>
        
        
         <strong> 
        <dd><a href="http://docs.locust.io/en/stable/writing-a-locustfile.html">stable</a></dd>
         </strong> 
        
        
        <dd><a href="http://docs.locust.io/en/0.9.0/writing-a-locustfile.html">0.9.0</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.8.1/writing-a-locustfile.html">v0.8.1</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.8/writing-a-locustfile.html">v0.8</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.7.5/writing-a-locustfile.html">v0.7.5</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.7.2/writing-a-locustfile.html">v0.7.2</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.7.1/writing-a-locustfile.html">v0.7.1</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.7/writing-a-locustfile.html">v0.7</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.6.2/writing-a-locustfile.html">v0.6.2</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.6.1/writing-a-locustfile.html">v0.6.1</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.6/writing-a-locustfile.html">v0.6</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/v0.5.1/writing-a-locustfile.html">v0.5.1</a></dd>
        
        
        
        <dd><a href="http://docs.locust.io/en/0.4/writing-a-locustfile.html">0.4</a></dd>
        
        
      </dl>
      
      

      
      
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="https://readthedocs.org/projects/locust/downloads/pdf/stable/">PDF</a></dd>
        
        <dd><a href="https://readthedocs.org/projects/locust/downloads/htmlzip/stable/">HTML</a></dd>
        
        <dd><a href="https://readthedocs.org/projects/locust/downloads/epub/stable/">Epub</a></dd>
        
      </dl>
      
      

      
      <dl>
        <!-- These are kept as relative links for internal installs that are http -->
        <dt>On Read the Docs</dt>
        <dd>
          <a href="https://readthedocs.org/projects/locust/">Project Home</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/locust/builds/">Builds</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/locust/downloads/">Downloads</a>
        </dd>
      </dl>
      

      

      
      <dl>
        <dt>On GitHub</dt>
        <dd>
          <a href="https://github.com/locustio/locust/blob/4bde2ca90f28bde649ff4ce2c86e36a6e6260856/docs/writing-a-locustfile.rst">View</a>
        </dd>
        
      </dl>
      
      

      
      <dl>
        <dt>Search</dt>
        <dd>
          <div style="padding: 6px;">
            <form id="flyout-search-form" class="wy-form" target="_blank" action="https://readthedocs.org/projects/locust/search/" method="get">
              <input type="text" name="q" placeholder="Search docs">
              </form>
          </div>
        </dd>
      </dl>
      



      <hr>
      
        <small>
          <span>Hosted by <a href="https://readthedocs.org/">Read the Docs</a></span>
          <span> · </span>
          <a href="https://docs.readthedocs.io/page/privacy-policy.html">Privacy Policy</a>
        </small>
      

      

</div>
</div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.9.0',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="./Locust 0.9.0文档5_files/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="./Locust 0.9.0文档5_files/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="./Locust 0.9.0文档5_files/underscore.js"></script>
      <script type="text/javascript" src="./Locust 0.9.0文档5_files/doctools.js"></script>
      <script type="text/javascript" src="./Locust 0.9.0文档5_files/readthedocs-doc-embed.js"></script>

  

  <script type="text/javascript" src="./Locust 0.9.0文档5_files/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./Locust 0.9.0文档5_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div> 


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>